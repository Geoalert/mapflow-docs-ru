QGIS
=============

.. attention::
 Данное приложение позволяет использовать ресурсы обработки Mapflow в QGIS. Для его использования потребуется доступ к :doc:`processing_api`, для этого напишите нам на **help@geoalert.io**.


Что такое QGIS
---------------


**QGIS** - это ведущая и найболее популярная настольная ГИС с открытым исходным кодом. Пользователи могут визуализировать, управлять, редактировать, анализировать данные и составлять печатные карты. Узнайте больше на официальном сайте `QGIS <https://www.qgis.org/>`_. 

При помощи данной ГИС  вы сможете подключить больше приложений и расширить функциональность вашего ядра, поскольку данная система имеет ресурсы для подключения внешних плагинов разработанных на Python. Наше приложение позволяет подключаться к Mapflow :doc:`processing_api` для запуска AI-моделей обработок и получать результаты процессинга в виде слоев для QGIS.


Пользовательский интерфейс
---------------------------

Рабочее окно плагина Geoalert разделено на 3 вкладки:

- Processing;
- Settings;
- Help;

1. Processing
~~~~~~~~~~~~~~~

    .. figure:: _static/qgis/processing_tab.png
         :alt: View of the processing tab
         :align: center
         :width: 15cm


**1.1. Область авторизации пользователя**

    *Login/Password*. В данной области необходимо ввести Login и Password. Перейдите на `mapflow.ai <https://mapflow.ai/ru>`_, зарегистрируйтесь и напишите в службу поддержки на сайте платформы запрос на предоставление доступа к API для работы с плагином.

    *Save Login/Password*. Сохранение персональных данных пользователя для дальнейшего использования плагина при его перезапуске.

    *Connect*. Кнопка входа в учетную запись пользователя.

**1.2. Область параметров обработки**

    *Processing name*. Название обработки.

    *AOI layer*. Область, по которой будет производиться обработка. Данный слой автоматически отображается в выпадающем списке из списка векторных слоев QGIS, загрузите этот слой в QGIS или нарисуйте его.

    *AI model*. Тип обработки. В выпадающем списке можно выбрать следующие типы обработки (дефолтный список сценариев обработки):
       
        - *Building Detection* (определение зданий);
        - *Roads Detection* (определение дорог);
        - *Forest Detection* (определение леса);
        - *Buildings detection With Heights* (определение зданий с высотами);
        - *Forest Detection With Heights* (определение леса с высотами).
        - *Imagery source*. Подложка. По умолчанию выбрано Mapbox Satellite, в выпадающем списке также можно выбрать Custom (см.  Settings) и Open new .tif.

    *Update image in cache*. Обновить изображение обработки в кэше.

    *Start processing*. Кнопка запуска новой обработки.
     
**1.3. Блок отображения и работы с процессингами**

    Окно процессингов состоит из:

    - *Processing*. Степень завершенности обработки в процентах.
    - *Name*. Название обработки.
    - *Status*. Статус обработки.
    - *Created*. Дата создания обработки.
    - *ID*. ID обработки.
    - *AI model*. Выбранный пользователем тип обработки в поле AI model.

    *Delete*. Кнопка удаления ранее произведенную обработку из окна процессингов.

    *Load processing results*. Кнопка, которая позволяет выгрузить полученный результат обработки в виде слоя в QGIS.

2. Settings
~~~~~~~~~~~~

.. figure:: _static/qgis/settings_tab.png
         :alt: View of the settings tab
         :align: center
         :width: 15cm

*Destination folder*. Путь к директории, в которую будет загружен результат обработки.

*Geoalert platform url*. URL-адрес платформы Geoalert.

*Custom Imagery provider URL*. URL-адрес поставщика результатов спутниковой съёмки.

*Raster tile type*. Растровый тип тайла. Можно выбрать xyz, tms, wms.

*Max zoom 14*. Зум размера 14 выбран по умолчанию, чтобы исключить расход платного трафика на предпросмотр (Актуально в случае подключения к Maxar SecureWatch. Просмотр данных с этого сервиса возможен с 9 зума. Можно использовать приближение до максимального 18 зума, сняв галочку).

*Preview*. Кнопка предпросмотра подложки указанного поставщика  спутниковой съёмки и геопространственных данных.

**Настройки Maxar SecureWatch**

*Login/Password*. Данные для входа в учетную запись SecureWatch.

*Save Login/Password*. Сохранение персональных данных пользователя для дальнейшей возможности подключения к ресурсам SecureWatch.

*Connect ID*. Идентификатор подключения к ресурсам SecureWatch. 

*Get URL*. Кнопка для получения URL-адреса поставщика данных спутниковой съёмки Maxar.

*AOI layer*. Область, по которой будут представлены meta-данные.

*Get image metadata*. Кнопка для запуска сбора meta-данных по выбранной области.

3. Help
~~~~~~~~

Во вкладке размещены все полезные ссылки для работы с данным плагином.

Как установить плагин
----------------------

Вам необходимо добавить внешний репозиторий с нашего сайта, нажать *Плагины* -> *Управление...* -> *Добавить…* и заполнить форму с именем и `URL-адресом репозитория <https://qgis.mapflow.ai/mapflow.xml>`_.
 
.. figure:: _static/qgis/add_repo.png
         :alt: Add repo
         :align: center
         :width: 15cm

После этого вы сможете увидеть, доступна ли более новая версия приложения, и проверить подробности в журнале изменений.
  

Как подключиться Maxar SecureWatch
------------------------------------

.. note::
    **SecureWatch** - это сервис, который обеспечивает гибкий доступ к оптическим снимкам, мирового лидера в области ДЗЗ, компании MAXAR. Пространственное разрешение снимков варьируется в диапазоне от 30 см до 1 м. Все снимки сопровождаются метаданными, включая информацию о дате и времени съемки, угле съемки и облачном покрове, пространственном разрешении, уровне обработка снимка и др.

На вкладке **Processing** в выпадающем списке *Imagery source* выберите *Custom (in settings)*.

 .. figure:: _static/qgis/Geoalert_processing.png
         :alt: Processing dialog
         :align: center
         :width: 15cm

2. Перейдите на вкладку **Settings**.
 
3. Введите ваши данные учетной записи  SecureWatch в поля *Login* и *Password*.

.. important:: 
    Если у вас нет учетной записи, зарегистрируйтесь на официальном сайте `SecureWatch <https://explore.maxar.com/securewatch-demo>`_.
 
4. Выберите *Maxar Securewatch*. Введите ваше *Connect ID*:

     4.1. Перейдите на `SecureWatch <https://securewatch.digitalglobe.com/myDigitalGlobe/logout-from-ended-session>`_.

     4.2. В строке заголовка выберите свое имя, затем выберите **View Profile**. Откроется диалоговое окно **User Profile**.
 
     4.3. Скопируйте свой идентификатор подключения с поля **Current Connect ID**.
     
     .. figure:: _static/qgis/SecureWatch_user_profile.jpg
         :alt: Your user profile in SecureWatch
         :align: center
         :width: 15cm

     .. attention::
         Обратите внимание, что **Connect ID** для каждой из мозаик разный. Поэтому выберите изначально ту, которая вам подходит. Для этого закройте окно *User Profile* и в строке заголовка выберите нужную из двух предложенных мозаик (**Vivid** и **SecureWatch**), щелкнув по названию одной из них.

     4.4. Вернитесь в QGIS к плагину **Geoalert**, в поле *Connect ID* вставьте скопированный ID.
   
5. Нажмите *Get URL*. 
     
Теперь слой Maxar доступен для предварительного просмотра в вашем списке растровых слоев и для обработки AI-мэппинга с помощью Mapflow.


Как использовать другие сервисы изображений
-------------------------------------------

Вы можете ввести URL-адрес источника данных спутниковой съёмки в одном из следующих форматов:

* XYZ
* TMS
* WMS

Все форматы представляют собой наиболее широко используемые протоколы для получения изображений с географической привязкой через http:
(Есть еще один тип, который поддерживается в Mapflow, это *quadkey*)


Как обрабатывать ваши собственные изображения
----------------------------------------------


Вы можете загрузить свой локальный растр в формате GeoTIF (*Open new .tif*). Каждый файл, добавленный в качестве растрового слоя в QGIS, отображается в раскрывающемся списке и может быть выбран для загрузки.

 .. figure:: _static/qgis/upload_tif.png
         :alt: Upload TIF, select from list
         :align: center
         :width: 15cm
